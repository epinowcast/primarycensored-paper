---
title: "Modelling delays with primary Event Censored Distributions"
author:
  - name: Samuel P. C. Brand
    affiliations:
      - name: Center for Forecasting and Outbreak Analytics, Centers for Disease Control and Prevention, United States of America
    corresponding: true
  - name: Carl Pearson
    affiliations:
      - name: Affiliation
    corresponding: false
  - name: Kelly Charniga
    affiliations:
      - name: Institut Pasteur, France
    corresponding: false
  - name: Sang Woo Park
    affiliations:
      - name: Department of Ecology and Evolution, University of Chicago, Chicago, Illinois, United States of America
    corresponding: false
  - name: James Mba Azam
    affiliations:
      - name: Centre for Mathematical Modelling of Infectious Diseases, London School of Hygiene & Tropical Medicine, London, United Kingdom
    corresponding: false
  - name: Adam Howes
    affiliations:
      - name: Center for Forecasting and Outbreak Analytics, Centers for Disease Control and Prevention, United States of America
    corresponding: false
  - name: Sebastian Funk
    affiliations:
      - name: Centre for Mathematical Modelling of Infectious Diseases, London School of Hygiene & Tropical Medicine, London, United Kingdom
    corresponding: false
  - name: Sam Abbott
    affiliations:
      - name: Centre for Mathematical Modelling of Infectious Diseases, London School of Hygiene & Tropical Medicine, London, United Kingdom
    corresponding: false
    email: sam.abbott@lshtm.ac.uk
date: today
format:
  html:
    toc: false
    number-sections: false
bibliography: reference.bib
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/plos.csl
---

## Abstract

## Author summary

## Introduction

Time-to-event distributions are essential in epidemiology, describing delays between events like infection and symptom onset. These inform disease natural history, enable nowcasting, and support epidemic reconstruction. However, real-world surveillance data present challenges due to censoring and truncation, which can significantly bias estimates if not properly addressed [@charniga2024best]. Inaccurate delay distributions directly impact critical response decisions during outbreaks, from resource allocation to intervention timing, potentially leading to mischaracterisation of epidemic dynamics and delayed public health actions [@Park2024.01.12.24301247].

A key challenge in epidemiological data is interval censoring, where event times are known only within specific intervals. Primary event censoring affects the initial event time (e.g., infection), secondary event censoring affects the end event time (e.g., symptom onset), and double interval censoring occurs when both are present [@charniga2024best; @Reich2009-aa]. These issues are compounded by right truncation, where events with longer delays are systematically missing from recent data because the secondary event hasn't yet occurred or been observed [@Park2024.01.12.24301247]. Each form of censoring introduces distinct biases that must be addressed for accurate estimation [@law1992effects].

Several approaches attempt to address these challenges, but each has limitations. Simple methods include discarding censored observations (infeasible when all data are censored) [@little2019statistical], discretisation (treating delays as occurring in fixed intervals), or fixed imputation (assuming events occur at interval midpoints). Park et al. found that treating unobserved primary event times as latent parameters proposed by Ward et al. improved upon fixed imputation [@Park2024.01.12.24301247; @Ward2022-wo], but this introduces N additional parameters when analysing N observations, limiting scalability to large datasets. Charniga et al. highlighted a persistent gap in computationally efficient methods for double interval censored data that maintain statistical rigour while scaling to large surveillance datasets [@charniga2024best].

In this paper, we aim to establish a standard approach for epidemiological delay distribution estimation that is statistically rigourous and computationally efficient. We extend Ward et al.'s method by marginalising over latent primary event times rather than treating them as individual parameters, maintaining statistical integrity while substantially improving scalability for large datasets. We first provide a general numerically solvable solution and then derive analytical solutions for common parametric distributions, including gamma, lognormal, and Weibull. We implement these methods in the open-source R package 'primarycensored' [@abbottprimarycensored], with both R functions and Stan extensions that integrate with existing tools like fitdistrplus and epidemiological modelling packages [@fitdistrplus; @stan; @abbottepinow2; @Cori2013]. In this paper, we present the statistical framework underlying our approach, derive analytical solutions for commonly used distributions, and evaluate our method using both simulated data and real-world case studies across a range of distributions. We first compare numerical accuracy and run time with the Ward et al. approach for recovering PMFs and then demonstrate parameter recovery versus a naive approach. Our method makes accurate delay distribution estimation feasible for large-scale surveillance datasets where previous approaches become computationally intractable. Our software tools enable using these approaches as part of more complex epidemiological models.

## Methods

### Statistical framework

#### Generative model
- Intuitive description of how delay data arises in epidemiology
- Random sampling process with concrete examples
- Visual illustration of primary and secondary event censoring 
- Effect of truncation on observed distributions
- Connection to real-world data collection

#### Problem statement
- Formal definition of double interval censoring and truncation
- Breaking the problem down into primary censoring and everything else
- Mathematical notation and variable definitions
- Assumptions about non-informative censoring

### Solving the censoring problem

#### Double censored and right truncated PMF
- Mathematical formulation of the overall PMF problem
- Introduction of F_cens as a placeholder for the primary censored CDF

#### Primary event censored distributions
- Focusing on the F_cens component
- Mathematical formulation of the primary censoring CDF problem 
- Derivation of the survival function approach
- Numerical or analytical solutions

### Analytical solutions

#### General approach
- Overview of analytical solution approach
- When analytical solutions are possible

#### Exponentially tilted primary event times
- Modeling non-uniform event distributions
- Application to epidemic growth/decay scenarios

#### Uniform primary intervals
- Special case of exponentially tilted primary event times
- High level maths overview of the simplification this leads to
- Key results (with details in SI)
- Table of distributions with known analytical solutions

### Connection to other approaches
- Connection to Park et al.
- Connection to Reich et al. 
- Connection to Cori et al.

### Software implementation

#### R interface
- Core functions and design principles
- User workflow

#### Stan implementation
- Stan functions
- Interfacing between R and Stan

#### fitdistrplus extensions
- Integration with existing R tools

### Evaluation design

#### Simulated datasets
- Three distributions with comparable means but varied shapes:
  * Gamma (moderate variance)
  * Lognormal (higher variance with heavier tail)
  * Burr (heaviest tail)
- Three truncation scenarios:
  * No truncation (retrospective scenario)
  * Moderate truncation (realistic real-time scenario)
  * Severe truncation (challenging real-time scenario)
- Consistent primary and secondary censoring windows across all scenarios but varying between individuals. Ranging from 1 day to 4 days for each primary and secondary event.
- Total of 9 reference datasets (3 distributions Ã— 3 truncation levels)
- Visualization approach: panel plots with distributions along columns and truncation scenarios along rows
- Simulate for a 10000 individuals

#### Numerical validation
- Comparison of analytical, numerical and Monte Carlo solutions at PMF stage
- Look at different sample sizes.
- Visualise comparison of different methods
- Relative runtime metrics

#### Parameter recovery
- Stan-based estimation protocol
- fitdistrplus-based estimation protocol
- Comparison with naive model approaches
- Look at different sample sizes.
- Visualisation of parameter recovery

### Case study
- Sierra Leone Ebola outbreak data
- Data description and preprocessing
- Analysis approach
- Comparison protocol with Park et al. results
- Visualisation of case study results
### Implementation details
- Software tools and versions
- Hardware specifications
- Reproducibility information

## Results

### Numerical validation results
- Accuracy comparison across scenarios and sample sizes
- Runtime performance comparison

### Parameter recovery results
- Stan-based estimation results across all scenarios and sample sizes
- fitdistrplus-based estimation results
- Comparison with naive models in both
- Need to have a main figure with a single sample size and then duplicates for different sample sizes in the SI for both.

### Case study results
- Estimated parameters and key findings
- Comparison with previous estimates from Park et al.
- Performance advantages demonstrated

## Discussion

### Summary

### Strengths and limitations

### Comparison with existing methods

### Future work

### Conclusions

## References

## Supporting information

### Detailed analytical solutions

#### General framework for analytical solutions
- Explanation of when analytical solutions are possible
- Role of partial expectation in deriving solutions

#### Solutions for exponentially tilted primary event times
- Complete derivation of equation for F_CP
- Limiting case for uniform distribution

#### Gamma distribution
- Full derivation of partial expectation
- Complete survival function and PMF formulations

#### Lognormal distribution
- Full derivation of partial expectation
- Complete survival function and PMF formulations

#### Weibull distribution
- Full derivation of partial expectation 
- Complete survival function and PMF formulations

### Mathematical details of the naive comparison model
- Derivation of the model used for comparison
- Explanation of the limitations and assumptions
- Implementation details

### Extended connections to other approaches
- Detailed mathematical connections to Park et al.
- Complete exposition of relationship to Reich et al.
- Formal connection to Cori et al. approach

### Extended numerical validation results
- Detailed accuracy metrics across all distributions and sample sizes
- Additional visualizations

### Extended parameter recovery results

#### Stan-based estimation
- Full results across all sample sizes
- Detailed convergence diagnostics
- Additional parameter visualizations

#### fitdistrplus-based estimation
- Full results across all sample sizes
- Convergence and optimization details

#### Comparison with naive models
- Complete comparative analysis
- Additional error metrics

### Extended case study results
- Complete parameter visualizations
- Additional comparative outputs
